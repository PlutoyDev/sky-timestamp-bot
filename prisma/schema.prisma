// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
  output = "build"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  shadowDatabaseUrl = env("SHADOW_DATABASE_URL")
}

model Guild {
  id String @id @db.VarChar(20) // Discord guild ID

  webhooks Webhook[]

  timeConfigs  TimeConfig[]
  recurConfigs RecurConfig[]
  eventConfigs EventConfig[]
}

model Webhook {
  id        String @id @db.VarChar(20)
  token     String @db.VarChar(68)
  username  String @db.VarChar(32)
  avatarURL String @db.VarChar(256)

  guildId   String @db.VarChar(20)
  channelId String @db.VarChar(20)

  Guild       Guild        @relation(fields: [guildId], references: [id])
  TimeConfig  TimeConfig?
  RecurConfig RecurConfig?
  EventConfig EventConfig?
}

model TimeConfig {
  id        String @id @default(uuid()) @db.Uuid
  guildId   String @db.VarChar(20)
  webhookId String @unique @db.VarChar(20)
  messageId String? @db.VarChar(20) 

  template String
  format   Json

  Guild   Guild   @relation(fields: [guildId], references: [id])
  Webhook Webhook @relation(fields: [webhookId], references: [id])
}

model RecurConfig {
  id        String @id @default(uuid()) @db.Uuid
  key       String
  guildId   String @db.VarChar(20)
  webhookId String @unique @db.VarChar(20)

  template String
  format   Json

  Guild   Guild   @relation(fields: [guildId], references: [id])
  Webhook Webhook @relation(fields: [webhookId], references: [id])
}

model EventConfig {
  id        String @id @default(uuid()) @db.Uuid
  key       String
  guildId   String @db.VarChar(20)
  webhookId String @unique @db.VarChar(20)

  template String
  format   Json

  Guild   Guild   @relation(fields: [guildId], references: [id])
  Webhook Webhook @relation(fields: [webhookId], references: [id])
}
